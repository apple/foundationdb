[configuration]
storageEngineExcludeTypes = [5] #FIXME: remove after allowing to do bulkloading with fetchKey and shardedrocksdb

# Do not support tenant, encryption, and TSS
tenantModes = ['disabled']
encryptModes = ['disabled']
disableTss = true # TODO(BulkLoad): support TSS. finishMoveShard should wait for TSS if a data move is bulkload data move.

# Instruct simulation to generate a simple, single-region config
generateFearless = false
simpleConfig = false

# Simple network configuration - single region, no satellites
minimumRegions = 1
#config = "single usable_regions=1 storage_engine=ssd-rocksdb-v1 perpetual_storage_wiggle=0 proxies=3"
config = "single usable_regions=1 storage_engine=ssd-rocksdb-v1 perpetual_storage_wiggle=0 commit_proxies=3 grv_proxies=3 resolvers=3 logs=3" # More robust config

# Disable all fault injection and network failures
buggify = false

[[knobs]]
# Copied from tests/fast/BulkDumping.toml
shard_encode_location_metadata = true
enable_read_lock_on_range = true
enable_version_vector = false
enable_version_vector_tlog_unicast = false
enable_version_vector_reply_recovery = false
min_byte_sampling_probability = 0.5
cc_enforce_use_unfit_dd_in_sim = true
disable_audit_storage_final_replica_check_in_sim = true
max_trace_lines = 5000000
bulkload_sim_failure_injection = false

# S3/Blobstore settings from S3Client.toml for stability/determinism
blobstore_max_connection_life = 300
blobstore_request_timeout_min = 300
blobstore_request_tries = 5
blobstore_connect_tries = 5
blobstore_connect_timeout = 30
http_send_size = 1024
http_read_size = 1024
connection_monitor_loop_time = 0.1
connection_monitor_timeout = 1.0
connection_monitor_idle_timeout = 60.0

# Reduce team allocation issues
dd_team_zero_server_left_log_delay = 0
dd_rebalance_parallelism = 1

[[test]]
testTitle = 'BulkDumpingWorkloadS3'
useDB = true
waitForQuiescence = false
connectionFailuresDisableDuration = 1000000

    [[test.workload]]
    testName = 'BulkDumpingWorkload'
    # 2 is BulkLoadTransportMethod::BLOBSTORE
    bulkLoadTransportMethod = 2
    # Use 127.0.0.1 rather than localhost. If 'localhost', code uses the ipv6 version.
    # if 127.0.0.1, its ipv4 which is likely where we started seaweed.
    # If running against joshua, refer to the seaweed instance running at seaweedfs.default.svc.cluster.local.
    jobRoot = 'blobstore://seaweedfs:tot4llys3cure@seaweedfs.default.svc.cluster.local:8333/bulkdump/dumps?bucket=bulkdumpingworkload&region=us-east-1&secure_connection=0&bypass_simulation=1&global_connection_pool=0&request_timeout=60'
    #jobRoot = 'blobstore://KEY:SECRET:TOKEN@127.0.0.1:8333/bulkdumping/dumps?bucket=bulkdumpingworkload&region=us-east-1&secure_connection=0&bypass_simulation=1&global_connection_pool=0&request_timeout=5'
    maxCancelTimes = 0 