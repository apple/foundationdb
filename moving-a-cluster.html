<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Moving a Cluster to New Machines &#8212; FoundationDB 7.1</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '7.1.25',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Transport Layer Security" href="tls.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>7.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Moving a Cluster to New Machines</a><ul>
<li><a class="reference internal" href="#goal">Goal</a></li>
<li><a class="reference internal" href="#challenge">Challenge</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="configuration.html" title="Previous Chapter: Configuration"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Configuration</span>
    </a>
  </li>
  <li>
    <a href="tls.html" title="Next Chapter: Transport Layer Security"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Transport Lay... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Moving a Cluster to New Machines</a><ul>
<li><a class="reference internal" href="#goal">Goal</a></li>
<li><a class="reference internal" href="#challenge">Challenge</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="moving-a-cluster-to-new-machines">
<h1>Moving a Cluster to New Machines</h1>
<div class="section" id="goal">
<h2>Goal</h2>
<p>Move a FoundationDB cluster to new machines.</p>
</div>
<div class="section" id="challenge">
<h2>Challenge</h2>
<p>You need to move an existing cluster to new machines, and you don&#8217;t want to risk data loss or downtime during the process.</p>
</div>
<div class="section" id="explanation">
<h2>Explanation</h2>
<p>Use basic administrative commands to add new machines to your cluster, migrate the data, and remove the old machines.
Recipe</p>
<p>To move your cluster to new machines, perform the following steps:</p>
<ol class="arabic simple">
<li>Provision your new machines.</li>
<li>Install the FoundationDB packages on each of the new machines.</li>
<li>Stop the FoundationDB service on the new machines:</li>
</ol>
<p>$ sudo service foundationdb stop</p>
<ol class="arabic" start="4">
<li><p class="first">Copy the fdb.cluster file from any one of the old machines to each of the new machines. If you need to modify the default configuration (e.g. changing the data storage location), you should do so now.</p>
</li>
<li><p class="first">Restart the FoundationDB service on each new machine:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo service foundationdb start
</pre></div>
</div>
</li>
<li><p class="first">Start <code class="docutils literal"><span class="pre">fdbcli</span></code> and run <code class="docutils literal"><span class="pre">status</span> <span class="pre">details</span></code>. This should show a number of processes equal to both old and new machines, with processes on the original machines serving as the cluster coordinators.</p>
</li>
<li><p class="first">Exclude the original machines from the cluster using <code class="docutils literal"><span class="pre">exclude</span></code> in <code class="docutils literal"><span class="pre">fdbcli</span></code>. This command will not return until all database state has been moved off of the original machines and fully replicated to the new machines. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fdb</span><span class="o">&gt;</span> <span class="n">exclude</span> <span class="mf">192.168.1.1</span><span class="p">:</span><span class="mi">4500</span> <span class="mf">192.168.1.2</span><span class="p">:</span><span class="mi">4500</span> <span class="mf">192.168.1.3</span><span class="p">:</span><span class="mi">4500</span> <span class="n">locality_dcid</span><span class="p">:</span><span class="n">primary</span><span class="o">-</span><span class="n">satellite</span> <span class="n">locality_zoneid</span><span class="p">:</span><span class="n">primary</span><span class="o">-</span><span class="n">satellite</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="mi">2</span> <span class="n">locality_machineid</span><span class="p">:</span><span class="n">primary</span><span class="o">-</span><span class="n">stateless</span><span class="o">-</span><span class="mi">1</span> <span class="n">locality_processid</span><span class="p">:</span><span class="mi">223</span><span class="n">be2da244ca0182375364e4d122c30</span> <span class="ow">or</span> <span class="nb">any</span> <span class="n">locality</span>
</pre></div>
</div>
</li>
<li><p class="first">Run <code class="docutils literal"><span class="pre">coordinators</span> <span class="pre">auto</span></code> in <code class="docutils literal"><span class="pre">fdbcli</span></code> to move coordination state to the new machines. Please note that this will cause the fdb.cluster file to be updated with the addresses of the new machines. Any currently connected clients will be notified and (assuming they have appropriate file system <a class="reference internal" href="administration.html#cluster-file-permissions"><span class="std std-ref">permissions</span></a>) will update their own copy of the cluster file. As long as the original machines are still running, any clients that connect to them will be automatically forwarded to the new cluster coordinators. However, if you have a client that has not yet connected or only connects intermittently, you will need to copy the new cluster file from one of the new machines to the client machine.</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">status</span> <span class="pre">details</span></code> command in the fdbcli will now show only the new processes (both as workers and coordinators), and you can safely shut down the older machines.</p>
</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/moving-a-cluster.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2021 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Nov 08, 2022.<br/>
    </p>
  </div>
</footer>
  </body>
</html>