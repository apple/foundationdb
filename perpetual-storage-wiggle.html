<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Perpetual Storage Wiggle &#8212; FoundationDB 7.4.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          FoundationDB</a>
        <span class="navbar-text navbar-version pull-left"><b>7.4.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="contents.html">Site Map</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Perpetual Storage Wiggle</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#example-commands">Example commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#monitor">Monitor</a><ul>
<li><a class="reference internal" href="#trace-events">Trace Events</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Perpetual Storage Wiggle</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#example-commands">Example commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#monitor">Monitor</a><ul>
<li><a class="reference internal" href="#trace-events">Trace Events</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <section id="perpetual-storage-wiggle">
<span id="id1"></span><h1>Perpetual Storage Wiggle</h1>
<p>This document covers the concept and usage of perpetual storage wiggle.</p>
<section id="summary">
<span id="perpetual-storage-wiggle-introduction"></span><h2>Summary</h2>
<p>Perpetual storage wiggle is a feature that forces the data distributor to constantly build new storage teams when the cluster is healthy. On a high-level note, the process is like this:</p>
<p>Order storage servers by their created time, from oldest to newest. For each storage server n:</p>
<ol class="loweralpha simple">
<li><p>Exclude storage server n.</p></li>
<li><p>Wait until all data has been moved off the storage server.</p></li>
<li><p>Include storage n</p></li>
</ol>
<p>Goto step a to wiggle the next storage server.</p>
<p>With a perpetual wiggle, storage migrations will be much less impactful. The wiggler will detect the healthy status based on healthy teams, available disk space and the number of unhealthy relocations. It will pause the wiggle until the cluster is healthy again.</p>
</section>
<section id="configuration">
<h2>Configuration</h2>
<p>You can configure the Perpetual Storage Wiggle via the FDB <a class="reference internal" href="command-line-interface.html#command-line-interface"><span class="std std-ref">command line interface</span></a>.</p>
<p>Note that to have the Perpetual Storage Wiggle change the storage engine type, you must configure <code class="docutils literal notranslate"><span class="pre">storage_migration_type=gradual</span></code>.</p>
<section id="example-commands">
<h3>Example commands</h3>
<p>Open perpetual storage wiggle: <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">perpetual_storage_wiggle=1</span></code>.</p>
<p>Disable perpetual storage wiggle on the cluster: <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">perpetual_storage_wiggle=0</span></code>.</p>
<p>Open perpetual storage wiggle for only processes matching the given locality key and value: <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">perpetual_storage_wiggle=1</span> <span class="pre">perpetual_storage_wiggle_locality=&lt;LOCALITY_KEY&gt;:&lt;LOCALITY_VALUE&gt;</span></code>.</p>
<p>Disable perpetual storage wiggle locality matching filter, which wiggles all the processes: <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">perpetual_storage_wiggle_locality=0</span></code>.</p>
</section>
</section>
<section id="monitor">
<h2>Monitor</h2>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">status</span></code> command will report the IP address of the Storage Server under wiggling.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">status</span> <span class="pre">json</span></code> command in the FDB <a class="reference internal" href="command-line-interface.html#command-line-interface"><span class="std std-ref">command line interface</span></a> will show the current <code class="docutils literal notranslate"><span class="pre">perpetual_storage_wiggle</span></code> value. Plus, the <code class="docutils literal notranslate"><span class="pre">cluster.storage_wiggler</span></code> field reports storage wiggle details.</p></li>
</ul>
<section id="trace-events">
<h3>Trace Events</h3>
<p><code class="docutils literal notranslate"><span class="pre">PerpetualStorageWiggleOpen</span></code> shows up when you switch on perpetual storage wiggle, while <code class="docutils literal notranslate"><span class="pre">PerpetualStorageWiggleClose</span></code> appears when you turn it off;</p>
<p><code class="docutils literal notranslate"><span class="pre">PerpetualStorageWiggleStart</span></code> event means the wiggler start wiggling 1 process, it also contains the process id of the wiggling process how many healthy teams we has now. Itâ€™s worthy to note <code class="docutils literal notranslate"><span class="pre">ExtraHealthyTeamCount</span></code> that indicates how many healthy team we need to restart the paused wiggler and <code class="docutils literal notranslate"><span class="pre">HealthyTeamCount</span></code>. If <code class="docutils literal notranslate"><span class="pre">ExtraHealthyTeamCount</span></code> keep being larger than team count, then you may need to add more storage server.</p>
<p><code class="docutils literal notranslate"><span class="pre">PerpetualStorageWigglePause</span></code> event shows up when the wiggler pause because it detect the cluster is unhealthy;</p>
<p><code class="docutils literal notranslate"><span class="pre">PerpetualStorageWiggleFinish</span></code> event indicates the wiggle is done on current process.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">MovingData</span></code> event, the field <code class="docutils literal notranslate"><span class="pre">PriorityStorageWiggle</span></code> shows how many relocations are in the queue because storage wiggle.</p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/perpetual-storage-wiggle.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2013-2025 Apple, Inc and the FoundationDB project authors.<br/>
      Last updated on Aug 29, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>